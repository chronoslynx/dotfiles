-- Import selected Mail messages & attachments to DEVONthink Pro.-- Created by Christian Grunenberg on Mon Mar 05 2012.-- Copyright (c) 2012-2015. All rights reserved.-- this string is used when the message subject is emptyproperty pNoSubjectString : "(no subject)"on date_to_iso(dt)	set {year:y, month:m, day:d} to dt	set y to text 2 through -1 of ((y + 10000) as text)	set m to text 2 through -1 of ((m + 100) as text)	set d to text 2 through -1 of ((d + 100) as text)	return y & "-" & m & "-" & dend date_to_isoon year_from_date(dt)	set {year:y, month:m, day:d} to dt	return (text 2 through -1 of ((y + 10000) as text)) & ""end year_from_datetell application "Mail"	try		set theSelection to the selection		set theFolder to (POSIX path of (path to temporary items))		if the length of theSelection is less than 1 then error "One or more messages must be selected."		repeat with theMessage in theSelection			my importMessage(theMessage, theFolder)		end repeat	on error error_message number error_number		if error_number is not -128 then display alert "Mail" message error_message as warning	end tryend tellon importMessage(theMessage, theFolder)	tell application "Mail"		try			tell theMessage				set {theDateReceived, theDateSent, theSender, theSubject, theSource, theReadFlag} to {the date received, the date sent, the sender, subject, the source, the read status}				set theISODate to my date_to_iso(theDateReceived)				set theName to theISODate & " " & theSubject & ".eml"				set theYear to my year_from_date(theDateReceived)			end tell			if theSubject is equal to "" then set theSubject to pNoSubjectString						set theAttachmentCount to count of mail attachments of theMessage			tell application "Keep It"				repeat until top level folder is not missing value					delay 1				end repeat				set theGroup to default import destination				if theAttachmentCount is greater than 0 then set theGroup to (make new folder in theGroup with properties {name:theSubject})				add text theSource as plain text file in theGroup with name theName							end tell		on error error_message number error_number			if error_number is not -128 then display alert "Mail" message error_message as warning		end try	end tellend importMessage